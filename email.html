<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <script src="//caja.appspot.com/caja.js"></script>
    <link href="static/css/email.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid">
        {{range $index, $message := .Messages}}
        <div class="row">
            <div class="col-md-4">
                <span class="sender">{{$message.Header.Get "From"}}</span>
                <span class="timestamp">{{$message.Header.Get "Date"}}</span>
            </div>
            <div class="col-md-8">
                <a href="{{$message.GmailLink}}">View this message in gmail</a>
            </div>
        </div>
        <div class="row">
            <div id="guest{{$index}}"></div>
        <!--        <div class="embedded"><div>{{$message.Body}}</div></div>-->
        </div>
        {{else}}
        <div class="row text-center" style="padding-top:40px">
            <a href="{{.AuthURL}}" class="btn btn-default">Check my mail</a>
        </div>
        {{end}}
    </div>
    <script>
        caja.initialize({
            cajaServer: 'https://caja.appspot.com/',
            debug: true
        });
        {{range $index, $message := .Messages}}
        caja.load(document.getElementById('guest{{$index}}'), undefined, function(frame) {
            frame.code('{{$message.BodyLink}}', 'text/html')
                 .run();
        });
        {{end}}
    </script>
</body>
</html>
